<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</title>
    <link rel="stylesheet" href="login_style.css">
</head>
<body>
    <div class="page-container">
        <header>
             <nav>
        <button class="button_documentation" onclick="navigateTo('documentation.html')">
            –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
        </button>
        <button class="button_simulation" id="simulation-btn" onclick="navigateTo('simulation.html')" disabled>
            –≠–∫–∑–∞–º–µ–Ω
        </button>
        <button class="button_trainer" onclick="navigateTo('trainer.html')">
            –¢—Ä–µ–Ω–∞–∂—ë—Ä
        </button>
        <button class="skill-button" onclick="navigateTo('skills.html')">
        </button>
        
        <button class="profile-button" id="profile-btn" onclick="toggleProfilePanel()">
        </button>
            </nav>

        <div class="profile-panel" id="profile-panel">
        <div class="profile-header">
            <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
            <button class="close-panel" onclick="closeProfilePanel()">√ó</button>
        </div>
        
        <div class="profile-info">
            <div class="user-avatar">
                <span>–ì</span>
            </div>
            <div class="user-details">
                <h4>–ì–æ—Å—Ç—å</h4>
                <p>–ì–æ—Å—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º</p>
            </div>
        </div>
        </header>
        
        <main>
            <h1 class="login-title">–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –ì–æ—Å—Ç—å!</h1>
            
            <p class="login-subtitle">
                –ó–¥–µ—Å—å –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏ –ø–æ –æ—Ö—Ä–∞–Ω–µ —Ç—Ä—É–¥–∞. 
                –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç—Ä–µ–Ω–∞–∂–µ—Ä, —á—Ç–æ–±—ã –ø—Ä–æ—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –±–∞–∑—ã –ï–ò–°–û–¢. 
                –ë—ã—Å—Ç—Ä–æ –∏ —É–¥–æ–±–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –í–∞–º –ø–æ–º–æ–∂–µ—Ç –Ø–Ω–¥–µ–∫—Å –ê–ª–∏—Å–∞. 
                –°–∏–º—É–ª—è—Ç–æ—Ä —ç–∫–∑–∞–º–µ–Ω–∞ –ø–æ–∑–≤–æ–ª–∏—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –í–∞—à—É –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –≤ —É—Å–ª–æ–≤–∏—è—Ö, 
                –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω—ã—Ö –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É —ç–∫–∑–∞–º–µ–Ω—É.
            </p>
            
            <div id="error-message" class="error-message"></div>
            
            <div class="auth-buttons">
                <!--
                <button class="yandex-button" onclick="loginWithYandex()" id="yandex-button">
                    <img src="https://yastatic.net/s3/vertis-front/_/i/favicons/yandex-app-2x.png" alt="Yandex">
                    –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å
                </button>
                -->
                
                <button class="guest-button" onclick="loginGuest()" id="guest-button">
                    –ù–ê–ß–ê–¢–¨
                </button>
            </div>
            
            <div class="info-section">
                * –í –≥–æ—Å—Ç–µ–≤–æ–º —Ä–µ–∂–∏–º–µ –≤–∞–º –¥–æ—Å—Ç—É–ø–Ω—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ <strong>–±–µ–∑</strong> —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞<br>
                –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –±–ª–æ–∫–∞–º –∏ —Ä–∞–∑–¥–µ–ª–∞–º.
            </div>
        </main>
    </div>

    <script src="api.js"></script>
    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—à–∏–±–∫–∏ –∏–∑ URL
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            const urlParams = new URLSearchParams(window.location.search);
            const error = urlParams.get('error');
            
            if (error) {
                showError(decodeURIComponent(error));
                // –£–±–∏—Ä–∞–µ–º –æ—à–∏–±–∫—É –∏–∑ URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        });
        
        function showError(message) {
            const errorEl = document.getElementById('error-message');
            errorEl.textContent = message;
            errorEl.classList.add('show');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                errorEl.classList.remove('show');
            }, 10000);
        }
        
        function loginWithYandex() {
            console.log('üîê –í—Ö–æ–¥ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å...');
            window.location.href = '/auth/yandex';
        }
        
        async function loginGuest() {
            const button = document.getElementById('guest-button');
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            button.disabled = true;
            button.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
            button.classList.add('loading');
            
            try {
                console.log('üë§ –ì–æ—Å—Ç–µ–≤–æ–π –≤—Ö–æ–¥...');
                const result = await window.examAPI.guestLogin();
                
                if (result.success) {
                    console.log('‚úÖ –ì–æ—Å—Ç–µ–≤–æ–π –≤—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω');
                    window.location.href = 'index.html';
                } else {
                    showError(result.error || '–û—à–∏–±–∫–∞ –≥–æ—Å—Ç–µ–≤–æ–≥–æ –≤—Ö–æ–¥–∞');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –≥–æ—Å—Ç–µ–≤–æ–≥–æ –≤—Ö–æ–¥–∞:', error);
                showError('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
            } finally {
                button.disabled = false;
                button.textContent = '–ù–ê–ß–ê–¢–¨';
                button.classList.remove('loading');
            }
        }

        function navigateTo(page) {
    window.location.href = page;
}

// –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ —Å–∏–º—É–ª—è—Ü–∏–∏
function checkSimulationAccess() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–æ–π–¥–µ–Ω—ã –ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
    const hasCompletedTraining = localStorage.getItem('training_completed');
    const simBtn = document.getElementById('simulation-btn');
    
    if (simBtn && hasCompletedTraining === 'true') {
        simBtn.disabled = false;
        simBtn.style.backgroundColor = '#4CAF50';
        simBtn.style.color = 'white';
        simBtn.style.borderColor = '#4CAF50';
    }
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    checkSimulationAccess();
    
    // –¢–∞–∫–∂–µ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã index.html
    if (typeof initIndexPage !== 'undefined') {
        initIndexPage();
    }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–∞–Ω–µ–ª–∏ –ø—Ä–æ—Ñ–∏–ª—è
function toggleProfilePanel() {
    const panel = document.getElementById('profile-panel');
    const overlay = document.querySelector('.overlay') || createOverlay();
    
    panel.classList.toggle('active');
    overlay.classList.toggle('active');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏
function closeProfilePanel() {
    const panel = document.getElementById('profile-panel');
    const overlay = document.querySelector('.overlay');
    
    if (panel) panel.classList.remove('active');
    if (overlay) overlay.classList.remove('active');
}

// –°–æ–∑–¥–∞–Ω–∏–µ –æ–≤–µ—Ä–ª–µ—è (—Ñ–æ–Ω –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è)
function createOverlay() {
    const overlay = document.createElement('div');
    overlay.className = 'overlay';
    overlay.onclick = closeProfilePanel;
    document.body.appendChild(overlay);
    return overlay;
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ ESC
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeProfilePanel();
    }
});

// –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞
function logout() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
        localStorage.clear();
        window.location.href = 'login.html';
    }
}

// –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É profile-button –≤ HTML
document.addEventListener('DOMContentLoaded', function() {
    const profileBtn = document.getElementById('profile-btn');
    if (profileBtn) {
        profileBtn.onclick = toggleProfilePanel;
    }
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Å—ã–ª–∫–∏ –≤–Ω—É—Ç—Ä–∏
    document.querySelectorAll('.menu-item').forEach(item => {
        item.addEventListener('click', function() {
            setTimeout(closeProfilePanel, 300); // –ó–∞–∫—Ä—ã—Ç—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞
        });
    });
});
    </script>
</body>
</html>